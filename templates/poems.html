<!DOCTYPE html>
<html>
<head>
	<title>Poem Manager</title>
	<style>
		body {
			background-color: #111;
			color: #fff;
			font-family: sans-serif;
			padding: 20px;
		}

		h2 {
			margin-top: 40px;
			font-size: 1.4em;
			border-bottom: 1px solid #333;
			padding-bottom: 5px;
		}
		
		.section {
			background-color: #1e1e1e;
			padding: 15px;
			border-radius: 10px;
			margin-bottom: 25px;
			box-shadow: 0 0 8px rgba(255,255,255,0.05);
		}
	
		input, textarea {
			width: 100%;
			padding: 10px;
			margin-top: 5px;
			margin-bottom: 10px;
			border: none;
			border-radius: 5px;
			background-color: #2c2c2c;
			color: #fff;
		}
		
		button {
			background-color: #007bff;
			color: white;
			padding: 8px 16px;
			border: none;
			border-radius: 5px;
			cursor: pointer;
			font-size: 0.9em;
		}

		.small-button {
			background-color: #444;
			font-size: 0.8em;
			margin-top: 5px;
		}
	</style>
</head>
<body>

	<h1 style="text-align: center;">🪞 Poem Manager</h1>

	<div class="section">
		<h2>✍️ Add a New Poem</h2>
		<form action="/add_poem" method="POST">
			<textarea name="poem_text" rows="4" placeholder="Write a new poem..."></textarea>
			<input type="text" name="author" placeholder="Author (optional)">
			<button type="submit">➕ Add Poem</button>
		</form>
	</div>

	<div class="section">
		<h2>💌 Send a Temporary Message</h2>
		<form action="/poem_override" method="POST">
			<input type="text" name="override_msg" placeholder="This message will replace poems temporarily">
			<button type="submit">📤 Send Message</button>
		</form>
		<p><strong>Current Override:</strong> {{ override or "None" }}</p>
		<form action="/clear_override" method="POST">
			<button class="small-button" type="submit">❌ Clear override</button>
		</form>
	</div>

	<div class="section">
		<h2>📜 Current Poem</h2>
		<pre id="current-poem" style="white-space: pre-wrap; border-color: #333;">Loading...</pre>

		<div style="margin-top: 10px;">
			<form action="/favorite_poem" method="POST" style="display:inline;">
				<button type="submit" class="small-button" title="Favorite">❤</button>
			</form>
			<form action="/remove_poem" method="POST" style="display:inline;">
				<button type="submit" class="small-button" title="Remove">✖</button>
			</form>
		</div>

		<script>
			function updateCurrentPoem() {
				fetch("http://192.168.1.177:5000/current_poem", { cache: "no-store" })
					.then(response => response.json())
					.then(data => {
						console.log("fetched data: ", data);
						const poemElement = document.getElementById("current-poem");
						if (!poemElement) {
							console.error("element with id 'current-poem' not found in DOM.");
							return;
						}

						if (data.error) {
							poemElement.textContent = data.error;
						} else {
							console.log("Updating poem element...");
							poemElement.textContent = `${data.text}\n\n- ${data.author}`;
						}
					})
					.catch(error => {
						console.error("Fetch errpr:", error);
						document.getElementById("current-poem").textContent = "Could not load current poem.";
					});
			}

			setInterval(updateCurrentPoem, 5000); // Refresh every 5 seconds
			updateCurrentPoem(); // Initial load
		</script>

	</div>

</body>
</html>
